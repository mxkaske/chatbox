import { useEffect, useState } from "react";
import dynamic from "next/dynamic";

const colors = require("tailwindcss/colors");

const ChatBoxWidget = dynamic({
  loader: () => import("@upstash/chatbox/chatbox"),
  ssr: false,
});

export default function Home() {
  const [chatID, setChatID] = useState(null);

  const [title, setTitle] = useState("");
  const [description, setDescription] = useState("");
  const [themeColor, setThemeColor] = useState(colors.emerald[500]);
  const [textColor, setTextColor] = useState("#ffffff");

  useEffect(() => {
    getID();
  }, [chatID]);

  function getID() {
    const storageFetched = localStorage.getItem("chatbox_id");

    if (!storageFetched) {
      setChatID(null);
      return null;
    }

    let id = JSON.parse(storageFetched!).value;
    setChatID(id);
    return id;
  }

  return (
    <main className="mx-auto w-full max-w-2xl py-20 px-6">
      <header>
        <h1 className="font-bold text-4xl">
          <a href="https://github.com/upstash/chatbox" target="_blank">
            @upstash/chatbox
          </a>
        </h1>

        <h4 className="mt-4 text-xl">
          Create a ChatBox Widget (like Intercom live chat) for your Next.js site. Nothing to maintain, it is completely serverless. 
        </h4>

        <p className="mt-2">
          When your website's visitor starts a session, the chat link is sent to
          your Slack channel.
        </p>
      </header>

      <hr className="my-16" />

      <div>
        <h2 className="font-bold text-3xl">Demo</h2>

        <ol className="mt-4 space-y-4 list-decimal list-inside">
          <li className="group">
            <b className="underline">Initiate a chat</b> session by clicking the
            button at the bottom right.
            <svg
              className="pointer-events-none transition opacity-0 group-hover:opacity-100 z-10 fixed right-24 bottom-10"
              width="160"
              viewBox="0 0 85 80"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.452 17.238C1.48133 17.194 1.48133 17.0913 1.452 16.93C1.39333 16.402 1.386 16.0353 1.43 15.83C1.37133 15.038 1.34933 14.576 1.364 14.444C1.39333 14.312 1.43733 14.2387 1.496 14.224C1.43733 14.136 1.37867 13.8133 1.32 13.256C1.276 12.6987 1.26867 12.3247 1.298 12.134C1.26867 12.0167 1.26133 11.8773 1.276 11.716C1.29067 11.54 1.31267 11.4227 1.342 11.364C1.31267 11.3347 1.29067 11.2247 1.276 11.034V10.044L1.32 9.472V8.988L1.452 8.306C1.408 8.23267 1.44467 8.10067 1.562 7.91C1.41533 7.602 1.56933 7.22067 2.024 6.766C2.03867 6.73667 2.20733 6.64133 2.53 6.48C2.794 6.46533 2.97 6.46533 3.058 6.48C3.16067 6.49467 3.30733 6.50933 3.498 6.524C3.70333 6.53867 3.85733 6.56067 3.96 6.59C4.224 6.678 4.356 6.91267 4.356 7.294V7.668C4.38533 8.196 4.4 8.592 4.4 8.856V9.34C4.4 9.53067 4.38533 9.64067 4.356 9.67C4.37067 9.72867 4.37067 9.868 4.356 10.088V10.462C4.312 10.9167 4.29733 11.1807 4.312 11.254L4.158 12.42C4.27533 12.464 4.69333 12.486 5.412 12.486H6.512C7.15733 12.486 7.56067 12.486 7.722 12.486C7.898 12.4713 8.008 12.42 8.052 12.332C8.11067 12.244 8.15467 12.1267 8.184 11.98C8.21333 11.8333 8.23533 11.6647 8.25 11.474C8.26467 11.2833 8.27933 11.166 8.294 11.122C8.382 11.0487 8.404 10.7333 8.36 10.176C8.36 10.132 8.38933 10.022 8.448 9.846C8.448 9.64067 8.47733 9.406 8.536 9.142C8.536 8.86333 8.58 8.62133 8.668 8.416C8.77067 8.196 8.844 8.01267 8.888 7.866C8.96133 7.61667 9.13733 7.404 9.416 7.228C9.78267 6.964 10.1347 6.79533 10.472 6.722H10.868C11.264 6.79533 11.396 7.16933 11.264 7.844C11.264 8.064 11.2053 8.35 11.088 8.702C10.956 9.39133 10.89 9.83867 10.89 10.044C10.89 10.2493 10.8313 10.6233 10.714 11.166C10.7433 11.4447 10.7433 11.628 10.714 11.716C10.6993 11.804 10.692 11.914 10.692 12.046C10.6627 12.3687 10.648 12.5887 10.648 12.706C10.6187 13.146 10.604 13.498 10.604 13.762C10.604 14.026 10.582 14.312 10.538 14.62C10.538 14.928 10.4867 15.2433 10.384 15.566L10.318 16.974C10.318 17.0767 10.3693 17.832 10.472 19.24C10.56 19.328 10.5893 19.504 10.56 19.768C10.5307 20.0173 10.4793 20.1933 10.406 20.296C10.3327 20.3987 10.252 20.4573 10.164 20.472C10.0907 20.4867 9.97333 20.494 9.812 20.494C9.47467 20.6847 9.20333 20.758 8.998 20.714C8.822 20.714 8.63867 20.6553 8.448 20.538C8.14 20.3767 7.942 20.1787 7.854 19.944C7.854 19.8413 7.832 19.7167 7.788 19.57C7.75867 19.4233 7.75867 19.2693 7.788 19.108C7.81733 18.932 7.82467 18.7487 7.81 18.558C7.81 18.3673 7.81 18.1473 7.81 17.898L7.832 17.634C7.80267 17.5753 7.81733 17.48 7.876 17.348C7.93467 17.216 7.942 17.1133 7.898 17.04V16.446L8.008 15.324C7.86133 15.2213 7.854 14.9793 7.986 14.598L8.03 14.422C7.854 14.466 7.69267 14.488 7.546 14.488C7.13533 14.5907 6.68067 14.642 6.182 14.642L4.202 14.576V14.818C4.17267 15.0527 4.16533 15.4047 4.18 15.874V16.292C4.19467 16.6733 4.202 17.216 4.202 17.92C4.26067 18.6827 4.29 19.2327 4.29 19.57L4.268 19.724C4.268 19.8413 4.25333 19.944 4.224 20.032C4.224 20.3107 4.15067 20.5013 4.004 20.604C3.872 20.7067 3.652 20.7727 3.344 20.802C3.036 20.8313 2.75733 20.7507 2.508 20.56C2.156 20.384 1.97267 20.2373 1.958 20.12C1.94333 20.0027 1.89933 19.8487 1.826 19.658C1.75267 19.5407 1.70133 19.4013 1.672 19.24C1.672 18.7707 1.66467 18.5067 1.65 18.448C1.606 18.3893 1.584 18.2867 1.584 18.14C1.584 17.9493 1.54 17.6487 1.452 17.238ZM17.5942 13.96C17.6528 13.74 17.6455 13.4613 17.5722 13.124C17.4695 13.036 17.3302 12.992 17.1542 12.992C16.9342 12.992 16.7362 13.1973 16.5602 13.608C16.3255 13.96 16.1495 14.3487 16.0322 14.774H16.0102C15.8488 15.39 15.7682 15.72 15.7682 15.764C16.0028 15.8227 16.1935 15.852 16.3402 15.852C16.4868 15.8373 16.6555 15.7567 16.8462 15.61C17.1835 15.2873 17.4328 14.7373 17.5942 13.96ZM17.5282 17.128L16.7142 17.194C16.2595 17.194 15.9002 17.15 15.6362 17.062L15.7022 17.48C15.7462 18.6973 16.0835 19.4967 16.7142 19.878C16.8902 19.9513 17.0368 19.988 17.1542 19.988C17.2715 19.988 17.4255 19.9293 17.6162 19.812C17.6748 19.7533 17.7262 19.6727 17.7702 19.57C17.7848 19.438 17.8582 19.3793 17.9902 19.394C18.5915 18.6313 19.0462 18.3307 19.3542 18.492C19.6622 18.6973 19.8162 18.8587 19.8162 18.976C19.8162 19.0347 19.7795 19.1007 19.7062 19.174V19.306C19.7062 19.4527 19.6108 19.7167 19.4202 20.098C19.2442 20.4793 19.0535 20.802 18.8482 21.066C18.7455 21.286 18.6135 21.44 18.4522 21.528C17.9828 21.8213 17.4842 21.9387 16.9562 21.88C16.8388 21.8653 16.7582 21.836 16.7142 21.792C16.5968 21.7627 16.5088 21.7553 16.4502 21.77L16.2742 21.748C16.1422 21.748 16.0322 21.7187 15.9442 21.66C15.7975 21.572 15.6948 21.528 15.6362 21.528C15.2548 21.3813 15.0202 21.2713 14.9322 21.198C14.8588 21.1247 14.7928 21.0733 14.7342 21.044C14.6755 21.0147 14.5362 20.8607 14.3162 20.582C14.1255 20.4207 14.0155 20.318 13.9862 20.274C13.8982 20.142 13.8175 20.0467 13.7442 19.988C13.6855 19.9293 13.6488 19.7973 13.6342 19.592C13.5755 19.5187 13.5462 19.4233 13.5462 19.306L13.4582 19.13C13.4582 19.0273 13.4142 18.9467 13.3262 18.888C13.2382 18.8 13.1942 18.69 13.1942 18.558V18.382C13.1355 18.3527 13.1208 18.2647 13.1502 18.118V17.546L13.1282 17.348V17.194C13.1135 17.1353 13.1282 17.0107 13.1722 16.82L13.1502 16.622C13.1648 16.6073 13.1868 16.49 13.2162 16.27C13.2748 15.962 13.3408 15.7713 13.4142 15.698V15.5C13.4288 15.456 13.4362 15.3973 13.4362 15.324C13.4362 15.2507 13.4508 15.17 13.4802 15.082C13.5242 14.994 13.6415 14.664 13.8322 14.092L14.1842 13.322C14.2868 13.102 14.4482 12.86 14.6682 12.596C14.6828 12.5227 14.7415 12.3907 14.8442 12.2L15.1302 11.936C15.2182 11.804 15.3502 11.7087 15.5262 11.65C15.7315 11.5473 15.8855 11.496 15.9882 11.496L16.6042 11.408C16.6775 11.4227 16.7288 11.43 16.7582 11.43H17.0442C17.3668 11.4593 17.6308 11.5253 17.8362 11.628C18.2762 11.76 18.5988 11.9287 18.8042 12.134C19.2588 12.6473 19.4862 13.1387 19.4862 13.608C19.4862 14.0773 19.4128 14.4807 19.2662 14.818C18.8995 15.654 18.6355 16.182 18.4742 16.402C18.2102 16.886 17.8948 17.128 17.5282 17.128ZM21.6616 14.51C21.6616 14.378 21.6469 14.224 21.6176 14.048V13.894C21.6322 13.7913 21.6249 13.6813 21.5956 13.564C21.5956 13.4173 21.6102 13.2853 21.6396 13.168C21.6396 12.8747 21.6762 12.684 21.7496 12.596C21.7496 12.5227 21.8522 12.354 22.0576 12.09C22.1162 12.0313 22.2262 11.936 22.3876 11.804C22.6222 11.7307 22.7836 11.6867 22.8716 11.672C22.9302 11.6133 23.1282 11.6353 23.4656 11.738C23.6122 11.7527 23.8396 11.804 24.1476 11.892C24.2502 11.9213 24.3822 12.0387 24.5436 12.244C24.5142 12.3027 24.4629 12.5227 24.3896 12.904C24.3309 13.2707 24.3089 13.5713 24.3236 13.806C24.4116 13.7327 24.5656 13.5787 24.7856 13.344C25.0056 13.1093 25.1229 12.9847 25.1376 12.97C25.5189 12.794 25.8929 12.6693 26.2596 12.596C26.7876 12.552 27.1322 12.5887 27.2936 12.706C27.4256 12.75 27.5282 12.816 27.6016 12.904C27.7336 13.0213 27.8436 13.2267 27.9316 13.52C28.0196 13.7987 28.0122 13.9747 27.9096 14.048C27.8216 14.1213 27.5282 14.18 27.0296 14.224C27.0002 14.224 26.8976 14.2827 26.7216 14.4L25.5776 15.302C25.3429 15.4193 25.1816 15.522 25.0936 15.61L24.6756 16.38C24.6609 16.4093 24.6462 16.6 24.6316 16.952C24.6169 17.304 24.6169 17.5607 24.6316 17.722C24.6462 17.8687 24.6462 18.36 24.6316 19.196V20.142C24.6316 20.6553 24.6242 20.9487 24.6096 21.022C24.5949 21.11 24.5362 21.2567 24.4336 21.462C24.3896 21.5353 24.2502 21.572 24.0156 21.572C23.4436 21.9973 23.0769 21.9753 22.9156 21.506L22.6296 21.33C22.5122 21.2713 22.4389 21.198 22.4096 21.11C22.2922 20.9487 22.2336 20.8533 22.2336 20.824L22.1456 20.516L22.0136 20.252C21.9696 20.2373 21.9329 19.9587 21.9036 19.416C21.8742 18.8587 21.8596 18.5213 21.8596 18.404C21.8596 18.272 21.8449 18.1327 21.8156 17.986C21.9182 17.8833 21.9622 17.7073 21.9476 17.458C21.9476 17.2087 21.9329 17.018 21.9036 16.886C21.8742 16.7393 21.8742 16.6513 21.9036 16.622C21.9329 16.578 21.9256 16.3727 21.8816 16.006C21.8376 15.9473 21.8302 15.8373 21.8596 15.676L21.6616 14.51ZM33.0101 12.926C32.9808 12.8527 32.8781 12.8233 32.7021 12.838C32.5408 12.8527 32.4161 12.9407 32.3281 13.102C31.7268 14.0553 31.4041 15.0747 31.3601 16.16C31.8588 16.2773 32.2841 16.0573 32.6361 15.5C33.0908 14.0627 33.2155 13.2047 33.0101 12.926ZM31.2941 21.66L31.0741 21.616L30.7661 21.308C30.6781 21.308 30.6121 21.2713 30.5681 21.198C30.4068 21.0073 30.1135 20.626 29.6881 20.054L29.3581 18.844C29.3581 18.6093 29.3141 18.404 29.2261 18.228C29.0795 17.568 28.9915 17.194 28.9621 17.106C28.9328 17.0033 28.9108 16.732 28.8961 16.292C28.8961 15.852 28.9181 15.5293 28.9621 15.324C29.0061 15.0453 29.2775 14.356 29.7761 13.256C29.9081 13.124 29.9888 12.948 30.0181 12.728L30.3701 12.222C30.6928 11.8407 31.0375 11.562 31.4041 11.386C31.4041 11.3567 31.6535 11.2833 32.1521 11.166C32.2548 11.1513 32.4895 11.188 32.8561 11.276C33.7361 11.4813 34.2861 11.738 34.5061 12.046L34.5721 12.156C34.8508 12.552 35.0121 13.1607 35.0561 13.982C35.0121 14.3487 34.9755 14.6567 34.9461 14.906C34.9168 15.1553 34.7555 15.61 34.4621 16.27C34.2421 16.6807 34.0295 17.0107 33.8241 17.26C33.5015 17.4947 33.2815 17.612 33.1641 17.612C33.1055 17.6413 32.9808 17.656 32.7901 17.656H32.2841C32.2401 17.6413 32.1448 17.634 31.9981 17.634C31.8515 17.634 31.6388 17.5973 31.3601 17.524C31.3601 17.8467 31.4481 18.3087 31.6241 18.91C31.8148 19.4967 31.9688 19.856 32.0861 19.988C32.3941 20.2227 32.6361 20.3767 32.8121 20.45C32.9881 20.5233 33.2228 20.538 33.5161 20.494C33.8095 20.4353 34.0221 20.3327 34.1541 20.186L34.7261 19.482C35.0928 18.9833 35.4668 18.9393 35.8481 19.35C36.0241 19.5407 36.0901 19.7313 36.0461 19.922C36.0168 20.098 35.8701 20.4573 35.6061 21C35.3861 21.352 35.1515 21.6453 34.9021 21.88C34.4475 22.1147 34.1761 22.232 34.0881 22.232C33.9561 22.2467 33.7508 22.2247 33.4721 22.166C33.3255 22.2393 33.0761 22.232 32.7241 22.144C32.7241 22.1147 32.6801 22.0927 32.5921 22.078C32.5188 22.078 32.4161 22.056 32.2841 22.012L32.3281 21.99C32.2988 21.99 32.2108 21.99 32.0641 21.99L31.4481 21.66H31.2941Z"
                fill="black"
              />
              <path
                d="M22 31C25.9707 43.6663 34.3233 54.504 45.5603 61.5702C56.7973 68.6364 70.1839 71.4689 83.32 69.56"
                stroke="black"
                strokeWidth="3"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              <path
                d="M69.0391 62.3433L83.3191 69.56L69.9292 78.3185"
                stroke="black"
                strokeWidth="3"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          </li>
          <li>
            <button
              type="button"
              className="font-bold underline"
              onClick={() => {
                const id = getID();
                if (!id) return alert("Initiate a chat on the widget first :)");
                window.open("chat/" + id, "_blank");
              }}
            >
              Visit admin page
            </button>{" "}
            to interact with the chat.️
          </li>
        </ol>

        <p className="mt-6 pl-6 py-4 border-l-4  border-l-emerald-500 bg-gradient-to-r from-emerald-50">
          Admin page link will also posted to the Slack channel in the format
          of <span className="font-semibold">yoursite.com/chat/:id</span>
        </p>

        <details className="mt-6 rounded px-4 py-3 bg-zinc-100">
          <summary className="cursor-pointer">Appearance</summary>

          <div className="mt-4 w-72 gap-2 grid grid-cols-2">
            <label>themeColor</label>
            <input
              type="color"
              value={themeColor}
              onChange={(e) => {
                setThemeColor(e.target.value);
              }}
            />
            <label>textColor</label>
            <input
              type="color"
              value={textColor}
              onChange={(e) => {
                setTextColor(e.target.value);
              }}
            />
            <label>title</label>
            <input
              className="px-2 py-1"
              type="text"
              value={title}
              onChange={(e) => {
                setTitle(e.target.value);
              }}
            />
            <label>description</label>
            <input
              className="px-2 py-1"
              type="text"
              value={description}
              onChange={(e) => {
                setDescription(e.target.value);
              }}
            />
          </div>
        </details>
      </div>

      <hr className="my-16" />

      <div>
        <h2 className="font-bold text-3xl">Setup</h2>

        <p className="mt-4">
          You can refer to the{" "}
          <a
            className="underline"
            target="_blank"
            href="https://github.com/upstash/chatbox"
          >
            GitHub README
          </a>{" "}
          file for installation.
        </p>
      </div>

      <ChatBoxWidget
        title={title}
        description={description}
        themeColor={themeColor}
        textColor={textColor}
      />
      <div className="pointer-events-none -z-20 fixed right-12 bottom-12 translate-y-1/2 translate-x-1/2 w-[1600px] h-[1600px] rounded-full bg-gradient-to-l from-emerald-200 rotate-45" />
      <div className="pointer-events-none z-10 fixed right-12 bottom-12 translate-y-1/2 translate-x-1/2 w-[70px] h-[70px] rounded-full bg-white" />
    </main>
  );
}
